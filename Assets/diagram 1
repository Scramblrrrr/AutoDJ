graph TD
    A[🎵 Audio Input] --> B[Professional Beat Analysis]
    B --> B1[Enhanced BPM Detection<br/>Spectral Flux + Energy]
    B --> B2[Downbeat Detection<br/>4/4 Time Signature]
    B --> B3[Phrase Detection<br/>8-bar/32-bar Analysis]
    B --> B4[Energy Curve Analysis<br/>Intro/Verse/Drop/Outro]
    
    B1 --> C[Beatgrid Generation]
    B2 --> C
    B3 --> C
    B4 --> C
    
    C --> C1[Beat Markers<br/>Time + Confidence]
    C --> C2[Transition Points<br/>Downbeat + Phrase]
    C --> C3[Vocal Activity<br/>Per Beat Estimation]
    
    D[🎼 Key Detection] --> D1[Chroma Features]
    D1 --> D2[Camelot Wheel<br/>Harmonic Analysis]
    
    E[🎚️ Stem Separation] --> E1[Vocals Stem]
    E1 --> F[Vocal Activity Analysis]
    E --> E2[Drums Stem]
    E --> E3[Bass Stem]
    E --> E4[Other Stem]
    
    F --> G[Intelligent Transition Engine]
    C --> G
    D2 --> G
    
    G --> H{Professional Transition Selection}
    
    H -->|High Vocal Activity| I[Echo-Out Transition<br/>BPM-Synced Echo]
    H -->|Perfect Match| J[Harmonic Crossfade<br/>10s Musical Blend]
    H -->|Good Match| K[Phrase-Aligned<br/>Downbeat Sync]
    H -->|Moderate Diff| L[Filter Sweep<br/>High/Low Pass]
    H -->|Key Compatible| M[Harmonic Break<br/>Creative Effects]
    H -->|Challenging| N[Effect Transition<br/>Dramatic Processing]
    
    I --> O[Professional Mixing Rules]
    J --> O
    K --> O
    L --> O
    M --> O
    N --> O
    
    O --> O1[❌ Never Overlap Vocals]
    O --> O2[✅ Complementary Layering]
    O --> O3[🎯 Phrase-Aligned Timing]
    O --> O4[🎼 Harmonic Compatibility]
    O --> O5[⚡ BPM-Synced Effects]
    
    O --> P[🔊 Professional Output<br/>Club-Quality DJ Mix]